# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 131381 2015-01-10 17:19:35Z ryandesign@macports.org $

PortSystem          1.0

name                vips
version             8.0.2
set branch          [join [lrange [split ${version} .] 0 1] .]
description         VIPS is an image processing library.
long_description    VIPS is an image processing library. It is good for \
                    large images and for colour.
maintainers         gmail.com:jcupitt
categories          graphics
platforms           darwin
license             LGPL-2.1+
homepage            http://www.vips.ecs.soton.ac.uk
master_sites        ${homepage}/supported/${branch}/

checksums           rmd160  9d53a0275c7d9a392003a48477cddbfd96d1708b \
                    sha256  1e6d102b425685467f58003f9d41cd097b772cdf50b4d7995f73751dce86fa3a

depends_build       port:gtk-doc \
                    port:pkgconfig

depends_lib         path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    path:lib/pkgconfig/pango.pc:pango \
                    port:cfitsio \
                    port:fftw-3 \
                    port:gobject-introspection \
                    port:ImageMagick \
                    port:jpeg \
                    port:lcms2 \
                    port:libexif \
                    port:libgsf \
                    port:libpng \
                    port:libtool \
                    port:libxml2 \
                    port:matio \
                    port:openexr \
                    port:openslide \
                    port:orc \
                    port:py27-gobject3 \
                    port:tiff \
                    port:zlib

configure.args      --enable-gtk-doc \
                    --enable-introspection

configure.env       PKG_CONFIG_PATH=${prefix}/Library/Frameworks/Python.framework/Versions/2.7/lib/pkgconfig

# gobject-introspection uses g-ir-scanner, which uses $CC from env
build.args-append   CC="${configure.cc} ${configure.cc_archflags}"

# The rules enabled by gobject-introspection require GNU make 3.81+
platform darwin 8 {
    depends_build-append    port:gmake
    build.cmd               ${prefix}/bin/gmake
}

livecheck.type      regex
livecheck.url       ${homepage}/supported/current/
livecheck.regex     >${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}<
