# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 130875 2015-01-03 12:30:17Z jann@macports.org $

PortSystem          1.0
PortGroup			github 1.0

github.setup        Cofyc dnscrypt-wrapper 41801dd
fetch.type          git

name                dnscrypt-wrapper
categories          net
license             ISC
maintainers         gmail.com:mschamschula openmaintainer
description         This is dnscrypt wrapper (server-side dnscrypt-proxy), which helps to \
                    add dnscrypt support to any name resolver.
long_description    ${description}
homepage            http://dnscrypt.org/

platforms           darwin
depends_build       port:autoconf
depends_lib         port:libevent \
                    port:libsodium

patchfiles          patch-Makefile.diff

pre-configure {
	system "cd ${worksrcpath} && make configure"
	system "cd ${worksrcpath} && git clone https://github.com/Cofyc/argparse.git -b master"
}

# startupitem.create      yes
# startupitem.netchange   yes
# startupitem.executable  ${prefix}/sbin/dnscrypt-proxy --daemonize --resolver-name=opendns

notes "
You need to generate keys and a pre-signed certificate:
dnscrypt-wrapper --gen-provider-keypair
dnscrypt-wrapper --gen-crypt-keypair
dnscrypt-wrapper --crypt-secretkey-file crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-publickey-file=public.key --provider-secretkey-file=secret.key --gen-cert-file

To run:
dnscrypt-wrapper  -r 8.8.8.8:53 -a 0.0.0.0:443  --crypt-secretkey-file=crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-cert-file=dnscrypt.cert --provider-name=your.host.com
"
