# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        cofyc dnscrypt-wrapper 0.2.2 v
revision            1

name                dnscrypt-wrapper
categories          net
license             ISC
maintainers         mps openmaintainer
description         This is dnscrypt wrapper (server-side dnscrypt-proxy), which helps to \
                    add dnscrypt support to any name resolver.
long_description    ${description}
homepage            https://dnscrypt.org/

platforms           darwin
depends_build       port:autoconf
depends_lib         port:libevent \
                    port:libsodium

checksums           rmd160  a51cb2d3a88741b2741810bd87d53658eaf75ece \
                    sha256  ff7e6773fb53454ddb2952892440516ee0a600a19cf7c2c124151cfad7b6ef70

patchfiles          patch-Makefile.diff

pre-configure {
	system "cd ${worksrcpath} && make configure"
}

# startupitem.create      yes
# startupitem.netchange   yes
# startupitem.executable  ${prefix}/sbin/dnscrypt-proxy --daemonize --resolver-name=opendns

notes "
You need to generate keys and a pre-signed certificate:
dnscrypt-wrapper --gen-provider-keypair
dnscrypt-wrapper --gen-crypt-keypair
dnscrypt-wrapper --crypt-secretkey-file crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-publickey-file=public.key --provider-secretkey-file=secret.key --gen-cert-file

To run:
dnscrypt-wrapper  -r 8.8.8.8:53 -a 0.0.0.0:443  --crypt-secretkey-file=crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-cert-file=dnscrypt.cert --provider-name=your.host.com
"
