# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        cofyc dnscrypt-wrapper 0.3 v

name                dnscrypt-wrapper
categories          net
license             ISC
maintainers         {mps @Schamschula} openmaintainer
description         This is dnscrypt wrapper (server-side dnscrypt-proxy), which helps to \
                    add dnscrypt support to any name resolver.
long_description    ${description}
homepage            https://dnscrypt.org/

platforms           darwin
depends_build       port:autoconf
depends_lib         port:libevent \
                    port:libsodium

checksums           rmd160  6fcac281d44a1e2057bad0c9b3981e68265aa789 \
                    sha256  457e947eaee0d0212cbb8b68a5d1e4252c74bc1c1f23ad715d3f46d2402d952b

patchfiles          patch-Makefile.diff

pre-configure {
	system "cd ${worksrcpath} && make configure"
}

# startupitem.create      yes
# startupitem.netchange   yes
# startupitem.executable  ${prefix}/sbin/dnscrypt-proxy --daemonize --resolver-name=opendns

notes "
You need to generate keys and a pre-signed certificate:
dnscrypt-wrapper --gen-provider-keypair
dnscrypt-wrapper --gen-crypt-keypair
dnscrypt-wrapper --crypt-secretkey-file crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-publickey-file=public.key --provider-secretkey-file=secret.key --gen-cert-file

To run:
dnscrypt-wrapper  -r 8.8.8.8:53 -a 0.0.0.0:443  --crypt-secretkey-file=crypt_secret.key --crypt-publickey-file=crypt_public.key --provider-cert-file=dnscrypt.cert --provider-name=your.host.com
"
