# $Id: Portfile 125544 2014-09-20 20:07:06Z devans@macports.org $

PortSystem 1.0

name                fop
version             2.0
categories          textproc java
license             Apache-2
maintainers         nomaintainer
platforms           darwin
supported_archs     noarch
description         Apache FOP Java XSL-FO Print Formatter
long_description    Apache FOP is the world's first print formatter driven by \
                    XSL formatting objects. It is a Java application that \
                    reads a formatting object tree conforming to the XSL 1.0 \
                    Recommendation (15 October 2001) and then turns it into a \
                    PDF document, certain other output formats or allows you \
                    to preview it directly on screen. Some parts of the XSL \
                    1.1 specification (work in progress!) have also been \
                    implemented.
homepage            http://xmlgraphics.apache.org/fop/

# Apache recommends at present that FOP be linked to FOP-specific versions of
# the Java libraries that it depends on (which are distributed with FOP), as
# both it and some of those libraries are undergoing a lot of changes, and they
# do not guarantee that FOP will work with any other versions.  We therefore
# might as well only use the binary distribution, unless anyone else comes up
# with a compelling reason to change this.  For the same reason, we also stick
# to the directory structure within the archive, since it isolates FOP and its
# libraries from conflicts with other versions.
distname            ${name}-${version}-bin
master_sites        apache:xmlgraphics/fop/binaries/
checksums           rmd160  c828215b2a8a0b62bd509306593cff8b3609454f \
                    sha256  1e90cfc9e07c2da088592860fa4651a7640c9e1e3500b71a613a5dea03eb3665
worksrcdir          ${name}-${version}

livecheck.regex     {(?i)<title>Apache FOP (.*)</title>}

patchfiles          java_home.patch

use_configure       no
build   {}
pre-destroot {
    delete ${worksrcpath}/fop.bat
    delete ${worksrcpath}/fop.cmd
    delete ${worksrcpath}/fop.js
}
destroot    {
    xinstall -m 755 -d ${destroot}${prefix}/share/java/fop/${version}
    set foppaths [glob ${worksrcpath}/*]
    foreach foppath ${foppaths} {
        copy $foppath ${destroot}${prefix}/share/java/fop/${version}
    }
    ln -fs ${prefix}/share/java/fop/${version}/fop \
        ${destroot}${prefix}/bin/fop
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/fop/${version}
    foreach fopdoc {KEYS LICENSE README NOTICE status.xml} {
        ln -fs ${prefix}/share/java/fop/${version}/${fopdoc} \
            ${destroot}${prefix}/share/doc/fop/${version}/${fopdoc}
    }
    foreach docdir {docs javadocs} {
        ln -fs ${prefix}/share/java/fop/${version}/${docdir} \
            ${destroot}${prefix}/share/doc/fop/${version}/${docdir}
    }
}

# Skeleton of a source variant, despite the comments above, just in case it
# proves useful to have one in the future :-)
#
#variant source description {Build FOP from source instead} {
#    distname            ${name}-${version}-src
#    master_sites        apache:xmlgraphics/fop/source/
#    checksums           md5 d0db54fe3a57a4eabf18599e339d2358 \
#                        sha1 f54750e12ccdaa2e08c1c4f2b66f27580c84d1e4 \
#                        rmd160 c828215b2a8a0b62bd509306593cff8b3609454f
#
#    depends_build       bin:ant:apache-ant
#    build.env-append    JAVA_HOME=/Library/Java/Home
#    build.cmd           ant
#    # Re-building local docs requires forrest, for which we don't yet have a
#    # port.
#    #build.target       all docs javadocs
#    build.target        all javadocs
#}

livecheck.type  regex
livecheck.url   http://www.apache.org/dist/xmlgraphics/fop/binaries/
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)-bin${extract.suffix}"
