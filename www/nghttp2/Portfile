# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 147204 2016-03-31 02:39:48Z khindenburg@macports.org $

PortSystem          1.0
PortGroup           cxx11 1.0
PortGroup           github 1.0

github.setup        tatsuhiro-t nghttp2 1.9.2 v
categories          www
platforms           darwin
maintainers         gmail.com:mschamschula openmaintainer
license             MIT

description         nghttp2 is an implementation of HTTP/2 in C.

long_description    ${description} Included are a HTTP/2 client, server and proxy. The \
                    package also provides a load test and benchmarking tool for HTTP/2.

github.tarball_from releases
use_xz              yes

checksums           rmd160 ef40a5c6782294116863e22890c0a74a54715fdb \
                    sha256 3d600ef8bfd151769559bc23806877b8b4eaf3d66776e6c1427b9c04cce8e853

depends_build       port:pkgconfig

depends_lib         port:jansson \
                    port:libev \
                    port:libevent \
                    port:libxml2 \
                    path:lib/libssl.dylib:openssl \
                    port:zlib

configure.args      --disable-silent-rules \
                    --disable-threads \
                    ac_cv_prog_AWK=/usr/bin/awk

configure.env       JANSSON_CFLAGS=-I${prefix}/include JANSSON_LIBS="-L${prefix}/lib -ljansson" \
                    LIBEVENT_OPENSSL_CFLAGS=-I${prefix}/include/event2 \
                    LIBEVENT_OPENSSL_LIBS="-L${prefix}/lib -levent -levent_openssl" \
                    OPENSSL_CFLAGS=-I${prefix}/include/openssl \
                    OPENSSL_LIBS="-L${prefix}/lib -lcrypto -lssl"

variant python27 conflicts python35 description {Build using Python 2.7} {
    depends_lib-append  port:py27-cython \
                        port:py27-setuptools \
                        port:python27
    
    configure.env-append   CYTHON=${prefix}/bin/cython-2.7 \
                           PYTHON=${prefix}/bin/python2.7 \
                           PYTHON_EXTRA_LDFLAGS="-u _PyMac_Error ${frameworks_dir}/Python.framework/Versions/2.7/Python"

    destroot.env        PYTHONPATH=${destroot}${prefix}/lib/python2.7/site-packages/

    pre-destroot {
        xinstall -d ${destroot}${prefix}/lib/python2.7/site-packages/
    }
}

variant python35 conflicts python27 description {Build using Python 3.5} {
    set PythonVersion   3.5
    set PythonBranch    [join [lrange [split ${PythonVersion} .] 0 1] ""]
    
    depends_lib-append  port:py35-cython \
                        port:py35-setuptools \
                        port:python35

    configure.env-append   CYTHON=${prefix}/bin/cython-3.5 \
                           PYTHON=${prefix}/bin/python3.5

    destroot.env        PYTHONPATH=${destroot}${prefix}/lib/python3.5/site-packages/

    pre-destroot {
        xinstall -d ${destroot}${prefix}/lib/python3.5/site-packages/
    }
}

if {![variant_isset python27] && ![variant_isset python35]} {
    default_variants +python27
}
