# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 130776 2015-01-02 20:30:50Z larryv@macports.org $

PortSystem          1.0

name                stunnel
version             5.10
set major           [lindex [split ${version} .] 0]
categories          security net
platforms           darwin
maintainers         gmail.com:mschamschula openmaintainer
license             GPL-2+

description         SSL tunneling program

long_description    Stunnel is a program that allows you to encrypt arbitrary \
                    TCP connections inside SSL (Secure Sockets Layer) available \
                    on both Unix and Windows. Stunnel can allow you to secure \
                    non-SSL aware daemons and protocols (like POP, IMAP, LDAP, \
                    etc) by having Stunnel provide the encryption, requiring no \
                    changes to the daemon's code.

homepage            http://www.stunnel.org/
master_sites        http://mirrors.zerg.biz/stunnel/ \
                    http://mirrors.zerg.biz/stunnel/archive/${major}.x/ \
                    ftp://ftp.stunnel.org/stunnel/

checksums           rmd160  a27e39ef72284e3f22fcd9344b4b0efa5847c819 \
                    sha256  032bfc1854f8a0b9e452343c36ec6b52c7e0daef0863423c6b13a61a7c92eb23

depends_lib         port:openssl

patchfiles          patch-configure \
                    patch-tools-stunnel.cnf

configure.args      --disable-libwrap \
                    --with-ssl=${prefix}

destroot.keepdirs   ${destroot}${prefix}/var/lib/stunnel
post-destroot {
    xinstall -d -m 770 -o nobody ${destroot}${prefix}/var/lib/stunnel/
}

# libwrap has been reported to introduce some problems with stunnel 4.18.
# See: https://trac.macports.org/ticket/11028
variant libwrap description {Include libwrap support} {
    depends_lib-append      port:tcp_wrappers
    configure.args-delete   --disable-libwrap
}

default_variants    +libwrap

startupitem.create      yes
startupitem.netchange   yes
startupitem.executable  ${prefix}/bin/stunnel ${prefix}/etc/stunnel/stunnel.conf

# Tell the user about the stupid fake certificate that we provide.
notes "
A fake certificate has been installed as ${prefix}/etc/stunnel/stunnel.pem
"

livecheck.type      regex
livecheck.url       ${homepage}downloads.html
livecheck.regex     ${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}
